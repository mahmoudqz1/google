Sub ExportEmailsToExcel()
    Dim olApp As Outlook.Application
    Dim olNamespace As Outlook.NameSpace
    Dim olFolder As Outlook.MAPIFolder
    Dim olMailItem As Outlook.MailItem
    Dim i As Integer
    Dim xlApp As Object
    Dim xlWorkbook As Object
    Dim xlWorksheet As Object

    Set olApp = New Outlook.Application
    Set olNamespace = olApp.GetNamespace("MAPI")
    Set olFolder = olNamespace.PickFolder
    
    Set xlApp = CreateObject("Excel.Application")
    Set xlWorkbook = xlApp.Workbooks.Add
    Set xlWorksheet = xlWorkbook.Worksheets(1)

    xlWorksheet.Cells(1, 1).Value = "Subject"
    xlWorksheet.Cells(1, 2).Value = "Sender"
    xlWorksheet.Cells(1, 3).Value = "Received Time"
    xlWorksheet.Cells(1, 4).Value = "Body"

    i = 2
    For Each olMailItem In olFolder.Items
        If olMailItem.Class = olMail Then
            xlWorksheet.Cells(i, 1).Value = olMailItem.Subject
            xlWorksheet.Cells(i, 2).Value = olMailItem.SenderName
            xlWorksheet.Cells(i, 3).Value = olMailItem.ReceivedTime
            xlWorksheet.Cells(i, 4).Value = olMailItem.Body
            i = i + 1
        End If
    Next olMailItem

    xlApp.Visible = True
    xlApp.UserControl = True
End Sub

